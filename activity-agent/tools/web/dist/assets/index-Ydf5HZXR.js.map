{"version":3,"file":"index-Ydf5HZXR.js","sources":["../../main.js"],"sourcesContent":["import './style.css'\n\nclass BroadcastFeed {\n  constructor() {\n    this.ws = null\n    this.activities = []\n    this.isConnected = false\n    \n    this.init()\n  }\n\n  init() {\n    this.connectWebSocket()\n    this.setupEventListeners()\n    this.loadInitialActivities()\n  }\n\n  connectWebSocket() {\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:'\n    const wsUrl = `${protocol}//${window.location.host}`\n    \n    this.ws = new WebSocket(wsUrl)\n    \n    this.ws.onopen = () => {\n      console.log('WebSocket connected')\n      this.isConnected = true\n      this.updateConnectionStatus(true)\n    }\n    \n    this.ws.onmessage = (event) => {\n      const message = JSON.parse(event.data)\n      this.handleWebSocketMessage(message)\n    }\n    \n    this.ws.onclose = () => {\n      console.log('WebSocket disconnected')\n      this.isConnected = false\n      this.updateConnectionStatus(false)\n      \n      // Reconnect after 3 seconds\n      setTimeout(() => this.connectWebSocket(), 3000)\n    }\n    \n    this.ws.onerror = (error) => {\n      console.error('WebSocket error:', error)\n    }\n  }\n\n  handleWebSocketMessage(message) {\n    switch (message.type) {\n      case 'initial_activities':\n        this.activities = message.data\n        this.renderActivities()\n        break\n        \n      case 'new_activity':\n        this.addActivity(message.data)\n        break\n        \n      case 'activities_cleared':\n        this.activities = []\n        this.renderActivities()\n        break\n    }\n  }\n\n  addActivity(activity) {\n    // Add to beginning with animation\n    this.activities.unshift(activity)\n    \n    // Keep only last 100 activities in memory\n    if (this.activities.length > 100) {\n      this.activities = this.activities.slice(0, 100)\n    }\n    \n    this.renderNewActivity(activity)\n  }\n\n  renderNewActivity(activity) {\n    const feed = document.getElementById('activity-feed')\n    const activityElement = this.createActivityElement(activity)\n    \n    // Add with animation\n    activityElement.style.opacity = '0'\n    activityElement.style.transform = 'translateY(-20px)'\n    \n    feed.insertBefore(activityElement, feed.firstChild)\n    \n    // Animate in\n    requestAnimationFrame(() => {\n      activityElement.style.transition = 'all 0.3s ease-out'\n      activityElement.style.opacity = '1'\n      activityElement.style.transform = 'translateY(0)'\n    })\n    \n    this.hideEmptyState()\n  }\n\n  renderActivities() {\n    const feed = document.getElementById('activity-feed')\n    const loading = document.getElementById('loading')\n    \n    loading.classList.add('hidden')\n    \n    if (this.activities.length === 0) {\n      this.showEmptyState()\n      return\n    }\n    \n    this.hideEmptyState()\n    \n    feed.innerHTML = ''\n    this.activities.forEach(activity => {\n      const element = this.createActivityElement(activity)\n      feed.appendChild(element)\n    })\n  }\n\n  createActivityElement(activity) {\n    const div = document.createElement('div')\n    \n    const typeColors = {\n      graphics: 'border-blue-500 bg-blue-500/10',\n      vision: 'border-green-500 bg-green-500/10', \n      sofie: 'border-purple-500 bg-purple-500/10',\n      system: 'border-red-500 bg-red-500/10',\n      user: 'border-yellow-500 bg-yellow-500/10'\n    }\n    \n    const typeIcons = {\n      graphics: 'üé®',\n      vision: 'üëÅÔ∏è',\n      sofie: 'üìã',\n      system: '‚öôÔ∏è',\n      user: 'üë§'\n    }\n    \n    const priorityClasses = {\n      critical: 'ring-2 ring-red-400 animate-pulse',\n      high: 'ring-1 ring-yellow-400',\n      normal: '',\n      low: 'opacity-75'\n    }\n    \n    const timeAgo = this.formatTimeAgo(activity.timestamp)\n    const colorClass = typeColors[activity.type] || typeColors.system\n    const icon = typeIcons[activity.type] || typeIcons.system\n    const priorityClass = priorityClasses[activity.priority] || ''\n    \n    div.className = `\n      p-4 rounded-xl border backdrop-blur-sm transition-all hover:scale-[1.02]\n      ${colorClass} ${priorityClass}\n    `\n    \n    div.innerHTML = `\n      <div class=\"flex items-start space-x-3\">\n        <div class=\"flex-shrink-0\">\n          <div class=\"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center\">\n            <span class=\"text-lg\">${icon}</span>\n          </div>\n        </div>\n        <div class=\"flex-1 min-w-0\">\n          <div class=\"flex items-center justify-between mb-1\">\n            <div class=\"flex items-center space-x-2\">\n              <span class=\"text-xs font-semibold px-2 py-1 rounded-full bg-gray-700 text-gray-300 uppercase\">\n                ${activity.type}\n              </span>\n              ${activity.priority === 'critical' ? '<span class=\"text-xs font-bold text-red-400\">CRITICAL</span>' : ''}\n              ${activity.priority === 'high' ? '<span class=\"text-xs font-semibold text-yellow-400\">HIGH</span>' : ''}\n            </div>\n            <span class=\"text-xs text-gray-500\">${timeAgo}</span>\n          </div>\n          <h4 class=\"text-sm font-semibold text-white mb-1\">${this.escapeHtml(activity.title)}</h4>\n          <p class=\"text-sm text-gray-300 leading-relaxed\">${this.escapeHtml(activity.message)}</p>\n          ${activity.agent !== 'unknown' ? `\n            <div class=\"mt-2 text-xs text-gray-500\">\n              by ${this.escapeHtml(activity.agent)}\n            </div>\n          ` : ''}\n          ${Object.keys(activity.metadata || {}).length > 0 ? `\n            <details class=\"mt-2\">\n              <summary class=\"text-xs text-gray-400 cursor-pointer hover:text-gray-300\">\n                Show metadata\n              </summary>\n              <pre class=\"text-xs text-gray-500 mt-1 bg-gray-800 p-2 rounded overflow-x-auto\">\n${JSON.stringify(activity.metadata, null, 2)}\n              </pre>\n            </details>\n          ` : ''}\n        </div>\n      </div>\n    `\n    \n    return div\n  }\n\n  formatTimeAgo(timestamp) {\n    const now = new Date()\n    const time = new Date(timestamp)\n    const diffMs = now - time\n    const diffSecs = Math.floor(diffMs / 1000)\n    const diffMins = Math.floor(diffSecs / 60)\n    const diffHours = Math.floor(diffMins / 60)\n    \n    if (diffSecs < 60) return 'just now'\n    if (diffMins < 60) return `${diffMins}m ago`\n    if (diffHours < 24) return `${diffHours}h ago`\n    return time.toLocaleDateString()\n  }\n\n  escapeHtml(text) {\n    const div = document.createElement('div')\n    div.textContent = text\n    return div.innerHTML\n  }\n\n  updateConnectionStatus(connected) {\n    const status = document.getElementById('connection-status')\n    const dot = status.querySelector('div')\n    const text = status.querySelector('span')\n    \n    if (connected) {\n      dot.className = 'w-2 h-2 bg-green-400 rounded-full animate-pulse'\n      text.textContent = 'Connected'\n    } else {\n      dot.className = 'w-2 h-2 bg-red-400 rounded-full'\n      text.textContent = 'Disconnected'\n    }\n  }\n\n  showEmptyState() {\n    document.getElementById('empty-state').classList.remove('hidden')\n  }\n\n  hideEmptyState() {\n    document.getElementById('empty-state').classList.add('hidden')\n  }\n\n  async loadInitialActivities() {\n    try {\n      const response = await fetch('/api/activities')\n      const activities = await response.json()\n      this.activities = activities\n      this.renderActivities()\n    } catch (error) {\n      console.error('Failed to load activities:', error)\n      document.getElementById('loading').classList.add('hidden')\n      this.showEmptyState()\n    }\n  }\n\n  setupEventListeners() {\n    // Clear button\n    document.getElementById('clear-btn').addEventListener('click', async () => {\n      if (confirm('Are you sure you want to clear all activities?')) {\n        try {\n          await fetch('/api/activities', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              type: 'system',\n              title: 'Feed Cleared',\n              message: 'Activity feed was cleared by user',\n              metadata: { action: 'clear' }\n            })\n          })\n        } catch (error) {\n          console.error('Failed to clear activities:', error)\n        }\n      }\n    })\n\n    // Test buttons\n    document.querySelectorAll('.test-btn').forEach(btn => {\n      btn.addEventListener('click', async () => {\n        const type = btn.dataset.type\n        await this.postTestActivity(type)\n      })\n    })\n  }\n\n  async postTestActivity(type) {\n    const testMessages = {\n      graphics: {\n        title: 'Name strap updated',\n        message: 'Added name graphic for John Smith, News Anchor',\n        metadata: { person: 'John Smith', role: 'News Anchor' }\n      },\n      vision: {\n        title: 'Screenshot analyzed',\n        message: 'Detected person speaking in bottom-left corner of screen',\n        metadata: { detected: 'person', location: 'bottom-left', confidence: 0.95 }\n      },\n      sofie: {\n        title: 'Rundown activated',\n        message: 'Evening News rundown is now live and ready for playout',\n        metadata: { rundown: 'evening-news', segments: 8, duration: '30:00' }\n      },\n      system: {\n        title: 'System Alert',\n        message: 'Camera 2 signal lost - switching to backup feed',\n        metadata: { camera: 2, action: 'backup_switch', severity: 'warning' }\n      }\n    }\n\n    const testData = testMessages[type]\n    if (!testData) return\n\n    try {\n      await fetch('/api/activities', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          type: type,\n          title: testData.title,\n          message: testData.message,\n          metadata: testData.metadata,\n          priority: type === 'system' ? 'high' : 'normal',\n          agent: 'test-interface'\n        })\n      })\n    } catch (error) {\n      console.error('Failed to post test activity:', error)\n    }\n  }\n}\n\n// Initialize the app\nnew BroadcastFeed()"],"names":["BroadcastFeed","wsUrl","event","message","error","activity","feed","activityElement","element","div","typeColors","typeIcons","priorityClasses","timeAgo","colorClass","icon","priorityClass","timestamp","now","time","diffMs","diffSecs","diffMins","diffHours","text","connected","status","dot","activities","btn","type","testData"],"mappings":"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"}